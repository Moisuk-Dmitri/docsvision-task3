{"version":3,"file":"extension.js","sources":["../../../../src/Logic/ApplicationBusinessTripLogic.ts","../../../../src/EventHandlers/ApplicationBusinessTripHandlers.ts","../../../../src/Index.ts"],"sourcesContent":["﻿import { ILayout } from \"@docsvision/webclient/System/$Layout\";\r\nimport { DirectoryDesignerRow } from \"@docsvision/webclient/BackOffice/DirectoryDesignerRow\";\r\nimport { GenModels } from \"@docsvision/webclient/Generated/DocsVision.WebClient.Models\";\r\nimport { $MessageBox } from \"@docsvision/webclient/System/$MessageBox\";\r\nimport { NumberControl } from \"@docsvision/webclient/Platform/Number\";\r\nimport { $DepartmentController, $DirectoryDesignerRowController, $EmployeeController } from \"@docsvision/webclient/Generated/DocsVision.WebClient.Controllers\";\r\nimport { MessageBox } from \"@docsvision/webclient/Helpers/MessageBox/MessageBox\";\r\nimport { StaffDirectoryItems } from \"@docsvision/webclient/BackOffice/StaffDirectoryItems\";\r\nimport { DateTimePicker } from \"@docsvision/webclient/Platform/DateTimePicker\";\r\nimport { Control } from \"@docsvision/webclient/Legacy/Control\";\r\nimport { TextBox } from \"@docsvision/webclient/Platform/TextBox\";\r\nimport { CustomButton } from \"@docsvision/webclient/Platform/CustomButton\";\r\n\r\n\r\nexport class ApplicationBusinessTripLogic {\r\n    public async supervisorCheckConfirmed(layout: ILayout): Promise<boolean> {\r\n        const staffCtrl = layout.controls.tryGet<StaffDirectoryItems>(\"coordinatingPerson\");\r\n        if (staffCtrl.params.value == null) {\r\n            await layout.getService($MessageBox).showError('Поле Согласующий пустое!');\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    public async updateStartDateByEndDate(startDateCtrl: DateTimePicker) {\r\n        const layout = startDateCtrl.layout;\r\n        const endDateCtrl = layout.controls.tryGet<DateTimePicker>(\"endDate\");\r\n\r\n        if (startDateCtrl.params.value >= endDateCtrl.params.value && endDateCtrl.params.value != null) {\r\n            startDateCtrl.params.value = null;\r\n        }\r\n    }\r\n\r\n    public async updateEndDateByStartDate(endDateCtrl: DateTimePicker) {\r\n        const layout = endDateCtrl.layout;\r\n        const startDateCtrl = layout.controls.tryGet<DateTimePicker>(\"startDate\");\r\n\r\n        if (endDateCtrl.params.value <= startDateCtrl.params.value && startDateCtrl.params.value != null) {\r\n            endDateCtrl.params.value = null;\r\n        }\r\n    }\r\n\r\n    public async printMainInfo(buttonCtrl: CustomButton) {\r\n        let layout = buttonCtrl.layout;\r\n\r\n        let cityId = layout.controls.tryGet<DirectoryDesignerRow>(\"cityRow\").params.value.id;\r\n        let cityName: string;\r\n        const url = `http://dvappserver.engineer.school:5004/api/v1/cards/4538149D-1FC7-4D41-A104-890342C6B4F8/1b1a44fb-1fb1-4876-83aa-95ad38907e24/${cityId}`;\r\n        await fetch(url, {\r\n            method: 'GET',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            }\r\n        })\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                const nameField = data.data.fields.find((field: any) => field.alias === \"Name\");\r\n                cityName = nameField ? nameField.value : null;\r\n            })\r\n            .catch(error => console.error('Error: fetch cityName was not completed', error));\r\n\r\n        let name = layout.controls.tryGet<TextBox>(\"titleTextBox\");\r\n        let dateOfCreation = layout.controls.tryGet<DateTimePicker>(\"date\");\r\n        let startDate = layout.controls.tryGet<DateTimePicker>(\"startDate\");\r\n        let endDate = layout.controls.tryGet<DateTimePicker>(\"endDate\");\r\n        let tripReason = layout.controls.tryGet<TextBox>(\"reason\");\r\n\r\n        if (!name.params.value ||\r\n            dateOfCreation.params.value == null ||\r\n            startDate.params.value == null ||\r\n            endDate.params.value == null ||\r\n            !tripReason.params.value ||\r\n            !cityName\r\n        ) {\r\n            await layout.getService($MessageBox).showError('Информация не заполнена!');\r\n            return;\r\n            }\r\n\r\n        await layout.getService($MessageBox).showInfo(\r\n            'Имя: ' + name.params.value + '\\n' +\r\n            'Дата создания: ' + dateOfCreation.params.value.toLocaleDateString('ru-RU') + '\\n' +\r\n            'Дата с: ' + startDate.params.value.toLocaleDateString('ru-RU') + '\\n' +\r\n            'Дата по: ' + endDate.params.value.toLocaleDateString('ru-RU') + '\\n' +\r\n            'Основание для поездки: ' + tripReason.params.value + '\\n' +\r\n            'Название города: ' + cityName\r\n        );\r\n    }\r\n}","﻿import { ILayout } from \"@docsvision/webclient/System/$Layout\";\r\nimport { CancelableEventArgs } from \"@docsvision/webclient/System/CancelableEventArgs\";\r\nimport { ICardSavingEventArgs } from \"@docsvision/webclient/System/ICardSavingEventArgs\";\r\nimport { Layout } from \"@docsvision/webclient/System/Layout\";\r\nimport { ApplicationBusinessTripLogic } from \"../Logic/ApplicationBusinessTripLogic\";\r\nimport { DirectoryDesignerRow } from \"@docsvision/webclient/BackOffice/DirectoryDesignerRow\";\r\nimport { GenModels } from \"@docsvision/webclient/Generated/DocsVision.WebClient.Models\";\r\nimport { IDataChangedEventArgs, IDataChangedEventArgsEx } from \"@docsvision/webclient/System/IDataChangedEventArgs\";\r\nimport { StaffDirectoryItems } from \"@docsvision/webclient/BackOffice/StaffDirectoryItems\";\r\nimport { CancelableEvent } from \"@docsvision/webclient/System/CancelableEvent\";\r\nimport { arg } from \"@docsvision/webclient/System/Decorators\";\r\nimport { DateTimePicker } from \"@docsvision/webclient/Platform/DateTimePicker\";\r\nimport { CustomButton } from \"@docsvision/webclient/Platform/CustomButton\";\r\n\r\n/**\r\n * Событие во время сохранения карточки\r\n * @param layout разметка\r\n * @param args аргументы\r\n */\r\nexport async function ddApplicationBusinessTrip_cardSaving(layout: ILayout, args: CancelableEventArgs<ICardSavingEventArgs>) {\r\n    if (!layout) { return; }\r\n    let logic = new ApplicationBusinessTripLogic();\r\n\r\n    args.wait();\r\n    if (!await logic.supervisorCheckConfirmed(layout)) {\r\n        args.cancel();\r\n        return;\r\n    }\r\n\r\n    args.accept();\r\n}\r\n\r\n/**\r\n * Событие во время сохранения карточки\r\n * @param sender контрол\r\n * @param args аргументы\r\n */\r\nexport async function ddApplicationBusinessTrip_onDataChanged(sender: DateTimePicker, args: IDataChangedEventArgsEx<GenModels.DateTimePickerType>) {\r\n    if (!sender) { return; }\r\n    let logic = new ApplicationBusinessTripLogic();\r\n\r\n    if (sender.params.name == \"startDate\") { await logic.updateStartDateByEndDate(sender); }\r\n    if (sender.params.name == \"endDate\") { await logic.updateEndDateByStartDate(sender); }\r\n}\r\n\r\n/**\r\n* Событие во время сохранения карточки\r\n* @param sender разметка\r\n*/\r\nexport async function ddApplicationBusinessTrip_OnClick(sender: CustomButton) {\r\n    if (!sender) { return; }\r\n    let logic = new ApplicationBusinessTripLogic();\r\n    await logic.printMainInfo(sender);\r\n}","﻿//import * as Feature1Handlers from \"./Feature1/Action1EventHandler\";\r\nimport * as ApplicationBusinessTripHandlers from \"./EventHandlers/ApplicationBusinessTripHandlers\";\r\nimport { extensionManager } from \"@docsvision/webclient/System/ExtensionManager\";\r\n//import { Service } from \"@docsvision/web/core/services\";\r\n//import { $RequestManager } from \"@docsvision/webclient/System/$RequestManager\";\r\n//import { $Feature1 } from \"./Feature1/$Feature1\";\r\n//import { Feature1Service } from \"./Feature1/$Feature1Service\";\r\n//import { Control1 } from \"./Feature1/Control1\";\r\n\r\n\r\n// Главная входная точка всего расширения\r\n// Данный файл должен импортировать прямо или косвенно все остальные файлы, \r\n// чтобы rollup смог собрать их все в один бандл.\r\n\r\n// Регистрация расширения позволяет корректно установить все\r\n// обработчики событий, сервисы и прочие сущности web-приложения.\r\nextensionManager.registerExtension({\r\n    name: \"TemplateWebExtension\",\r\n    version: \"1.0\",\r\n    globalEventHandlers: [ApplicationBusinessTripHandlers ],\r\n    layoutServices: [ \r\n    //    Service.fromFactory($Feature1, (services: $RequestManager) => new Feature1Service(services))\r\n    ],\r\n    controls: [\r\n    //    { controlTypeName: \"Control1\", constructor: Control1 }\r\n    ]\r\n})"],"names":["$MessageBox","extensionManager"],"mappings":"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"}